<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-US">
  <head>
  <title>Introduction to Lua the Extensible Extension Language</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" type="text/css" media="screen, projection, print" href="../css/slidy.css" />
    <link rel="stylesheet" type="text/css" href="../css/highlighting.css" />
    <script charset="utf-8" type="text/javascript" src="../js/slidy.js"> </script>
  </head>
  <body>
      <div id="introduction" class="titleslide slide section level1"><h1>Introduction</h1></div><div id="what-is-lua" class="slide section level2">
<h2>What is Lua</h2>
<ul>
<li>It is an embeddable scripting language</li>
<li>It is dynamically typed</li>
<li>It runs on a register-based virtual machine</li>
<li>It has automatic memory management with incremental GC</li>
<li>It has simple procedural <em>C</em> and <em>Pascal</em> like syntax</li>
<li>It has good support for functional and declarative paradigms
<ul>
<li>Functions are first class objects</li>
<li>Lexically scoped closures</li>
<li>Tail recursion</li>
</ul></li>
<li>Its is portable and minimalist
<ul>
<li>Portable ANSI C</li>
<li>Does not come with batteries</li>
<li>Can squeeze runtime and standard libraries into approximately 98 KB (usually 182K to 243K)</li>
</ul></li>
</ul>
</div><div id="where-did-come-from-where-is-it-used" class="slide section level2">
<h2>Where did come from where is it used</h2>
<ul>
<li>Tecgraf group at PUC-Rio Brazil</li>
<li>Lua means moon in Portugese</li>
<li>Used a lot in gaming (World of Warcaft, Angry Birds)</li>
<li>Used to add scripting to applications (SciTE, WireShark, Awesome)</li>
<li>Full blown systems
<ul>
<li>Premake - cross platform building</li>
<li>Sputnik - web content management system</li>
</ul></li>
<li>Embedded systems through eLua
<ul>
<li>Targets running directly on microcontroller</li>
<li>eLuaBrain - eLua based full dev environment on MCU</li>
</ul></li>
<li>Mobile - Supported on iOS and Android</li>
</ul>
</div><div id="what-flavours-are-there" class="slide section level2">
<h2>What flavours are there</h2>
<dl>
<dt>Lua 5.1.x</dt>
<dd>Most widely used standard Lua distribution
</dd>
<dd>Supports any system that can compile ANSI C Lua 5.2.x
</dd>
<dd>The newest Lua.
</dd>
<dd>Not that widely supported yet.
</dd>
<dd>Supports any system that can compile ANSI C LuaJit
</dd>
<dd>Blindingly fast just in time compiler that is Lua 5.1.x compatible.
</dd>
<dd>Supports dynamic FFI to <em>C</em> shared libraries
</dd>
<dd><p>Supported OS</p>
<ul>
<li>Linux</li>
<li>Android</li>
<li>BSD</li>
<li>OSX</li>
<li>iOS</li>
<li>Windows</li>
</ul>
</dd>
<dd><p>Supported CPU</p>
<ul>
<li>x86 32 bit 64 bit</li>
<li>ARMv5+, ARM9E+</li>
<li>PPC/e500v2</li>
<li>MIPS</li>
</ul>
</dd>
</dl>
</div><div id="how-to-get-it" class="slide section level2">
<h2>How to get it</h2>
<ul>
<li>Get the source and compile into your application
<ul>
<li><a href="http://www.lua.org/versions.html" class="uri">http://www.lua.org/versions.html</a></li>
<li><a href="http://luajit.org/download.html" class="uri">http://luajit.org/download.html</a></li>
</ul></li>
<li>Use LuaRocks <a href="http://luarocks.org/" class="uri">http://luarocks.org/</a>
<ul>
<li>Deployment and management system for Lua modules</li>
</ul></li>
<li>Use LuaDist <a href="http://luadist.org/" class="uri">http://luadist.org/</a>
<ul>
<li>Deployment and management system for Lua modules</li>
</ul></li>
<li>Install Lua for Windows <a href="https://code.google.com/p/luaforwindows/" class="uri">https://code.google.com/p/luaforwindows/</a>
<ul>
<li>Batteries included installation.</li>
</ul></li>
</ul>
</div>
<div id="the-language" class="titleslide slide section level1"><h1>The Language</h1></div><div id="comments" class="slide section level2">
<h2>Comments</h2>
<div class="sourceCode"><pre class="sourceCode stretch lua"><code class="sourceCode lua"><span class="do">-- This is a single line comment</span>
<span class="do">--[[ This is a multiline </span>
<span class="do">     comment</span>
<span class="do">--]]</span>
<span class="do">--[=[ This is a multiline </span>
<span class="do">     comment</span>
<span class="do">    --[[ </span>
<span class="do">        With a nested multiline </span>
<span class="do">        comment</span>
<span class="do">    --]]</span>

<span class="do">    Any amount of `=` allowed the start and end count must just match</span>
<span class="do">--]=]</span></code></pre></div>
</div><div id="statements" class="slide section level2">
<h2>Statements</h2>
<ul>
<li><p>Each line is a new statement and default scope is global</p>
<div class="sourceCode"><pre class="sourceCode stretch lua"><code class="sourceCode lua">a <span class="ot">=</span> <span class="dv">1</span>       <span class="do">-- global variable </span>
<span class="kw">local</span> b <span class="ot">=</span> <span class="dv">2</span> <span class="do">-- prepend with 'local' to bind to lexical scope</span></code></pre></div></li>
<li><p>Standard standard <em>C</em> and <em>Pascal</em> like binary operators</p>
<div class="sourceCode"><pre class="sourceCode stretch lua"><code class="sourceCode lua">e <span class="ot">=</span> a <span class="ot">+</span> b       <span class="do">-- add</span>
e <span class="ot">=</span> a <span class="ot">-</span> b       <span class="do">-- subtract</span>
e <span class="ot">=</span> a <span class="ot">*</span> b       <span class="do">-- multiply</span>
e <span class="ot">=</span> a % b       <span class="do">-- modulus</span>
e <span class="ot">=</span> a <span class="ot">^</span> b       <span class="do">-- a to power b</span>
e <span class="ot">=</span> a <span class="ot">==</span> b      <span class="do">-- equality</span>
e <span class="ot">=</span> a <span class="ot">~=</span> b      <span class="do">-- inequality</span>
e <span class="ot">=</span> a <span class="ot">&lt;</span> b       <span class="do">-- less than</span>
e <span class="ot">=</span> a <span class="ot">&gt;</span> b       <span class="do">-- greater than</span>
e <span class="ot">=</span> a <span class="ot">&lt;=</span> b      <span class="do">-- less than equal</span>
e <span class="ot">=</span> a <span class="ot">&gt;=</span> b<span class="ot">;</span>     <span class="do">-- greater than equal</span>
e <span class="ot">=</span> <span class="st">&quot;ss&quot;</span> <span class="ot">..</span> <span class="st">&quot;XX&quot;</span><span class="do">-- string concatenation</span></code></pre></div></li>
</ul>
</div><div id="statements-continued" class="slide section level2">
<h2>Statements continued</h2>
<ul>
<li><p>Multiple assignment supported and multiple statements per line separated by <strong>;</strong></p>
<div class="sourceCode"><pre class="sourceCode stretch lua"><code class="sourceCode lua">a<span class="ot">,</span> b <span class="ot">=</span> b<span class="ot">,</span> a         <span class="do">-- this swaps the values of a and b</span>
<span class="kw">local</span> c <span class="ot">=</span> <span class="dv">3</span><span class="ot">;</span> d <span class="ot">=</span> <span class="dv">4</span><span class="ot">;</span> <span class="do">-- multiple statements per line</span>
<span class="do">-- define local variable e with no value bound to it</span>
<span class="kw">local</span> e<span class="ot">;</span>            <span class="do">-- ';' not necessary but OK.</span></code></pre></div></li>
<li><p>Logical operators a bit different (<strong>nil</strong> and <strong>false</strong> is false everything else is true)</p>
<div class="sourceCode"><pre class="sourceCode stretch lua"><code class="sourceCode lua"><span class="do">-- stops on false or nil , returns last evaluated value</span>
e <span class="ot">=</span> a <span class="kw">and</span> b         <span class="do">-- if a true then b else false</span>
<span class="do">-- stops on true (not false or nil ), returns last evaluated value</span>
e <span class="ot">=</span> a <span class="kw">or</span> b          <span class="do">-- if a true then a else b</span>
<span class="do">-- Logically invert </span>
e <span class="ot">=</span> <span class="kw">not</span> a           <span class="do">-- if a false then true else false</span>
<span class="do">-- using and and or for conditional assignment</span>
e <span class="ot">=</span> IAmNotDefined <span class="kw">or</span> <span class="st">'So default value'</span> <span class="do">-- result is the string</span>
e <span class="ot">=</span> IamNotDefined <span class="kw">and</span> IamNotDefined<span class="ot">()</span>   <span class="do">-- this does not crash </span></code></pre></div></li>
</ul>
</div><div id="types" class="slide section level2">
<h2>Types</h2>
<p>All values in Lua are <em>first-class</em> (stored in variables; passed as arguments; returned as results)</p>
<dl>
<dt>nil</dt>
<dd>The bottom type signifying nothing boolean
</dd>
<dd>The logical type can either be <code>true</code> or <code>false</code>.
</dd>
<dd><code>nil</code> and <code>false</code> counts as false everything else is true. number
</dd>
<dd>The only arithmetic type.
</dd>
<dd>Runtime dependant usually <code>double</code> (could be <code>char</code>, <code>short</code>, <code>int</code>, <code>float</code>). string
</dd>
<dd>Immutable array of 8-bit <code>char</code> values.
</dd>
<dd>8-bit clean i.e.Â may include embedded zeros <code>'\0'</code>
</dd>
</dl>
</div><div id="types-continued" class="slide section level2">
<h2>Types continued</h2>
<dl>
<dt>function</dt>
<dd>Any function defined in <em>Lua</em>
</dd>
<dd>Any function defined in <em>C</em> and exposed to <em>Lua</em>
</dd>
<dd>Any compiled file or string of <em>Lua</em> statements thread
</dd>
<dd>Represents independent thread of execution.
</dd>
<dd>Not <em>OS</em> threads used for coroutines userdata
</dd>
<dd>Arbitrary <em>C</em> data to be stored in <em>Lua</em>
</dd>
<dd>Only operations are assignment and identity test table
</dd>
<dd>The only data structure in <em>Lua</em>
</dd>
<dd>Associative arrays
</dd>
<dd>Heterogeneous in value and key (any type except <code>nil</code>)
</dd>
</dl>
</div><div id="strings" class="slide section level2">
<h2>Strings</h2>
<ul>
<li>Escaped strings
<ul>
<li><code>'Some\n &quot;blah&quot; string\' don't need to escape\''</code></li>
<li><code>&quot;Some\n 'blah' string\&quot; don't need to escape \&quot;&quot;</code></li>
</ul></li>
<li><p>Literal strings</p>
<div class="sourceCode"><pre class="sourceCode stretch lua"><code class="sourceCode lua"><span class="kw">local</span> someString <span class="ot">=</span> <span class="st">[[</span>
<span class="st">first new line is ignored</span>
<span class="st">this is a new line but this </span><span class="ot">\n</span><span class="st"> is not</span>
<span class="st">]]</span>

<span class="st">local anotherString = [=[the string does not end here]]</span>
<span class="st">[[some text]]</span>
<span class="st">the string ends here]=]</span></code></pre></div></li>
</ul>
</div><div id="tables" class="slide section level2">
<h2>Tables</h2>
<ul>
<li><p>Indexing</p>
<div class="sourceCode"><pre class="sourceCode stretch lua"><code class="sourceCode lua">a <span class="ot">=</span> t<span class="ot">[</span><span class="dv">1</span><span class="ot">]</span>        <span class="do">-- access array element 1</span>
a <span class="ot">=</span> t<span class="ot">[</span><span class="st">'blah'</span><span class="ot">]</span>   <span class="do">-- access element string key 'blah'</span>
a <span class="ot">=</span> t<span class="ot">.</span>blah      <span class="do">-- syntactic sugar for t['blah']</span></code></pre></div></li>
<li><p>Constructors</p>
<div class="sourceCode"><pre class="sourceCode stretch lua"><code class="sourceCode lua"><span class="do">-- empty table</span>
t <span class="ot">=</span> <span class="ot">{}</span>

<span class="do">-- simple array elements are t[1], t[2], t[3]</span>
t <span class="ot">=</span> <span class="ot">{</span><span class="st">&quot;blah&quot;</span><span class="ot">,</span> <span class="dv">1</span><span class="ot">,</span> <span class="kw">true</span><span class="ot">}</span>

<span class="do">-- simple map elements t['blah'], t['foo']</span>
t <span class="ot">=</span> <span class="ot">{</span>blah <span class="ot">=</span> <span class="dv">5</span><span class="ot">,</span> foo<span class="ot">=</span><span class="kw">true</span><span class="ot">}</span>

<span class="do">-- Explicit keys</span>
t <span class="ot">=</span> <span class="ot">{[</span><span class="st">'blah'</span><span class="ot">]</span> <span class="ot">=</span> <span class="dv">5</span><span class="ot">,</span> <span class="ot">[</span><span class="dv">100</span><span class="ot">]</span> <span class="ot">=</span> <span class="kw">true</span><span class="ot">}</span>

<span class="do">-- mixed elements at t[1], t[2], t[100], t.foo t.bar</span>
t <span class="ot">=</span> 
<span class="ot">{</span>   <span class="st">'alpha'</span><span class="ot">,</span> <span class="st">'bravo'</span><span class="ot">;</span>   <span class="do">-- element separator either , or ;</span>
    foo <span class="ot">=</span> <span class="dv">5</span><span class="ot">;</span> bar<span class="ot">=</span><span class="dv">4</span><span class="ot">,</span>
    <span class="ot">[</span><span class="dv">100</span><span class="ot">]</span> <span class="ot">=</span> <span class="kw">false</span><span class="ot">,</span>
<span class="ot">}</span></code></pre></div></li>
<li><p>Insertion and deletion</p>
<div class="sourceCode"><pre class="sourceCode stretch lua"><code class="sourceCode lua">t<span class="ot">.</span>foo <span class="ot">=</span> <span class="dv">5</span>   <span class="do">-- Insert value 5 at key foo</span>
t<span class="ot">.</span>foo <span class="ot">=</span> <span class="kw">nil</span> <span class="do">-- Delete key foo from table</span></code></pre></div></li>
</ul>
</div><div id="functions" class="slide section level2">
<h2>Functions</h2>
<ul>
<li>All functions have an environment
<ul>
<li>The environment is a Lua table</li>
<li>Global write inserts into the table</li>
<li>Global read performs table lookup</li>
<li>Local values shadow global values</li>
</ul></li>
<li>A Lua file is actually a function</li>
<li><p>Function definition</p>
<div class="sourceCode"><pre class="sourceCode stretch lua"><code class="sourceCode lua">    <span class="kw">function</span> <span class="ot">(</span>arg1<span class="ot">,</span> arg2<span class="ot">)</span> <span class="kw">return</span> arg1 <span class="ot">+</span> arg2 <span class="kw">end</span></code></pre></div>
<ul>
<li>Start function scope with keyword <code>function</code></li>
<li>Follow it with argument list <code>(a1, a2, ...)</code></li>
<li>End function scope with keyword <code>end</code></li>
<li>All statements between start and end are in function scope</li>
<li>Optional keyword <code>return</code> returns functions result</li>
</ul></li>
<li><p>Global function assignment</p>
<div class="sourceCode"><pre class="sourceCode stretch lua"><code class="sourceCode lua"><span class="do">-- This is syntax sugar</span>
<span class="kw">function</span> arb <span class="ot">(</span>arg1<span class="ot">,</span> arg2<span class="ot">)</span> <span class="kw">return</span> arg1 <span class="ot">+</span> arg2 <span class="kw">end</span>
<span class="do">-- for this assignment of a function to the global 'arb'</span>
arb <span class="ot">=</span> <span class="kw">function</span> <span class="ot">(</span>arg1<span class="ot">,</span> arg2<span class="ot">)</span> <span class="kw">return</span> arg1 <span class="ot">+</span> arg2 <span class="kw">end</span> </code></pre></div></li>
<li><p>Local function assignment</p>
<div class="sourceCode"><pre class="sourceCode stretch lua"><code class="sourceCode lua"><span class="do">-- This is syntax sugar</span>
<span class="kw">local</span> <span class="kw">function</span> arb <span class="ot">(</span>arg1<span class="ot">,</span> arg2<span class="ot">)</span> <span class="kw">return</span> arg1 <span class="ot">+</span> arg2 <span class="kw">end</span>
<span class="do">-- for this assignment of a function to the local 'arb'</span>
<span class="kw">local</span> arb <span class="ot">=</span> <span class="kw">function</span> <span class="ot">(</span>arg1<span class="ot">,</span> arg2<span class="ot">)</span> <span class="kw">return</span> arg1 <span class="ot">+</span> arg2 <span class="kw">end</span> </code></pre></div></li>
</ul>
</div><div id="functions-continued" class="slide section level2">
<h2>Functions continued</h2>
<ul>
<li><p>Table function insertion</p>
<div class="sourceCode"><pre class="sourceCode stretch lua"><code class="sourceCode lua"><span class="do">-- This is syntax sugar</span>
<span class="kw">function</span> t<span class="ot">.</span>arb <span class="ot">(</span>arg1<span class="ot">,</span> arg2<span class="ot">)</span> <span class="kw">return</span> arg1 <span class="ot">+</span> arg2 <span class="kw">end</span>
<span class="do">-- for this insertion of a function into table t at key arb</span>
t<span class="ot">[</span><span class="st">'arb'</span><span class="ot">]</span> <span class="ot">=</span> <span class="kw">function</span> <span class="ot">(</span>arg1<span class="ot">,</span> arg2<span class="ot">)</span> <span class="kw">return</span> arg1 <span class="ot">+</span> arg2 <span class="kw">end</span></code></pre></div></li>
<li><p>Table function insertion with implicit <code>self</code></p>
<div class="sourceCode"><pre class="sourceCode stretch lua"><code class="sourceCode lua"><span class="do">-- This is syntax sugar</span>
<span class="kw">function</span> t:arb <span class="ot">(</span>arg1<span class="ot">,</span> arg2<span class="ot">)</span> 
    <span class="kw">return</span> arg1 <span class="ot">+</span> arg2 <span class="ot">+</span> self<span class="ot">[</span><span class="dv">1</span><span class="ot">]</span>
<span class="kw">end</span>
<span class="do">-- for this insertion of a function into table t at key arb</span>
<span class="do">-- and explicit self parameter</span>
t<span class="ot">[</span><span class="st">'arb'</span><span class="ot">]</span> <span class="ot">=</span> <span class="kw">function</span> <span class="ot">(</span>self<span class="ot">,</span> arg1<span class="ot">,</span> arg2<span class="ot">)</span> 
    <span class="kw">return</span> arg1 <span class="ot">+</span> arg2 <span class="ot">+</span> self<span class="ot">[</span><span class="dv">1</span><span class="ot">]</span>
<span class="kw">end</span></code></pre></div></li>
<li><p>Function called by applying argument list to function value</p>
<div class="sourceCode"><pre class="sourceCode stretch lua"><code class="sourceCode lua"><span class="kw">local</span> arb <span class="ot">=</span> <span class="kw">function</span> <span class="ot">(</span>a<span class="ot">)</span> <span class="kw">return</span> a <span class="ot">+</span> a <span class="kw">end</span>
<span class="kw">local</span> x <span class="ot">=</span> arb<span class="ot">(</span><span class="dv">2</span><span class="ot">)</span>    <span class="do">-- x is 4</span></code></pre></div></li>
<li><p>Calling function implicitly passing <code>self</code></p>
<div class="sourceCode"><pre class="sourceCode stretch lua"><code class="sourceCode lua"><span class="kw">local</span> t <span class="ot">=</span> <span class="ot">{</span>
    arb <span class="ot">=</span> <span class="kw">function</span><span class="ot">(</span>self<span class="ot">,</span> a<span class="ot">)</span> 
        <span class="kw">return</span> self<span class="ot">.</span>x <span class="ot">+</span> a 
    <span class="kw">end</span><span class="ot">;</span> 
    x <span class="ot">=</span> <span class="dv">1</span><span class="ot">;</span> <span class="do">-- trailing delimiter is fine</span>
<span class="ot">}</span>
<span class="do">-- This is syntax sugar for </span>
<span class="kw">local</span> b <span class="ot">=</span> t:arb<span class="ot">(</span><span class="dv">2</span><span class="ot">)</span>
<span class="do">-- this lookup of arb in t and passing it t and 2</span>
<span class="kw">local</span> c <span class="ot">=</span> t<span class="ot">.</span>arb<span class="ot">(</span>t<span class="ot">,</span> <span class="dv">2</span><span class="ot">)</span></code></pre></div></li>
</ul>
</div><div id="functions-continued-1" class="slide section level2">
<h2>Functions continued</h2>
<ul>
<li><p>Parentheses optional when calling function with literal string</p>
<div class="sourceCode"><pre class="sourceCode stretch lua"><code class="sourceCode lua"><span class="do">-- This is syntax sugar</span>
<span class="fu">print</span> <span class="st">&quot;blah&quot;</span>
<span class="do">-- for this</span>
<span class="fu">print</span><span class="ot">(</span><span class="st">&quot;blah&quot;</span><span class="ot">)</span></code></pre></div></li>
<li><p>Parentheses optional when calling function with table constructor</p>
<div class="sourceCode"><pre class="sourceCode stretch lua"><code class="sourceCode lua"><span class="do">-- This is syntax sugar</span>
<span class="fu">ipairs</span> <span class="ot">{</span><span class="dv">1</span><span class="ot">,</span><span class="dv">2</span><span class="ot">,</span><span class="dv">3</span><span class="ot">,</span><span class="dv">4</span><span class="ot">}</span>
<span class="do">-- for this</span>
<span class="fu">ipairs</span> <span class="ot">({</span><span class="dv">1</span><span class="ot">,</span><span class="dv">2</span><span class="ot">,</span><span class="dv">3</span><span class="ot">,</span><span class="dv">4</span><span class="ot">})</span></code></pre></div></li>
<li><p>Function return types are dynamic</p>
<div class="sourceCode"><pre class="sourceCode stretch lua"><code class="sourceCode lua"><span class="kw">function</span> arb<span class="ot">(</span>x<span class="ot">)</span>
    <span class="kw">if</span>      x <span class="ot">==</span> <span class="dv">1</span>      <span class="kw">then</span>   <span class="kw">return</span> <span class="dv">3</span><span class="ot">,</span><span class="dv">4</span>
    <span class="kw">elseif</span>  x <span class="ot">==</span> <span class="st">'j'</span>    <span class="kw">then</span>   <span class="kw">return</span> <span class="st">'bob'</span><span class="ot">,</span><span class="dv">8</span>
    <span class="kw">elseif</span>  x <span class="ot">==</span> <span class="st">'m'</span>    <span class="kw">then</span>   <span class="kw">return</span> <span class="kw">nil</span><span class="ot">,</span><span class="st">'s'</span>
    <span class="kw">elseif</span>  x <span class="ot">==</span> <span class="dv">2</span>      <span class="kw">then</span>   <span class="kw">return</span> <span class="dv">4</span>
    <span class="kw">else</span>
        <span class="do">-- returning nothing</span>
    <span class="kw">end</span>
<span class="kw">end</span>
a<span class="ot">,</span>b <span class="ot">=</span> arb<span class="ot">(</span><span class="dv">1</span><span class="ot">)</span>    <span class="do">-- a == 3, b == 4</span>
a<span class="ot">,</span>b <span class="ot">=</span> arb<span class="ot">(</span><span class="st">'j'</span><span class="ot">)</span>  <span class="do">-- a == 'bob', b == 8</span>
a<span class="ot">,</span>b <span class="ot">=</span> arb<span class="ot">(</span><span class="st">'m'</span><span class="ot">)</span>  <span class="do">-- a == nil, b == 's'</span>
a<span class="ot">,</span>b <span class="ot">=</span> arb<span class="ot">(</span><span class="dv">2</span><span class="ot">)</span>    <span class="do">-- a == 4, b == nil</span>
a<span class="ot">,</span>b <span class="ot">=</span> arb<span class="ot">(</span><span class="dv">3</span><span class="ot">)</span>    <span class="do">-- a == nil, b == nil</span></code></pre></div></li>
</ul>
</div><div id="functions-continued-2" class="slide section level2">
<h2>Functions continued</h2>
<ul>
<li><p>Functions support closures</p>
<div class="sourceCode"><pre class="sourceCode stretch lua"><code class="sourceCode lua"><span class="kw">local</span> <span class="kw">function</span> makeCounter<span class="ot">()</span>
    <span class="kw">local</span> count <span class="ot">=</span> <span class="ot">-</span><span class="dv">1</span>            <span class="do">-- local variable</span>
    <span class="kw">return</span> <span class="kw">function</span> <span class="ot">()</span>          <span class="do">-- return the function</span>
        <span class="do">-- capture `count` updating on each invocation</span>
        <span class="kw">return</span> count <span class="ot">=</span> count <span class="ot">+</span> <span class="dv">1</span>
    <span class="kw">end</span>
<span class="kw">end</span>
<span class="kw">local</span> c1 <span class="ot">=</span> makeCounter<span class="ot">()</span>
<span class="kw">local</span> _<span class="dv">1</span><span class="ot">,</span> _<span class="dv">2</span><span class="ot">,</span> _<span class="dv">3</span> <span class="ot">=</span> c1<span class="ot">(),</span> c1<span class="ot">(),</span> c1<span class="ot">()</span> <span class="do">-- _1 == 0, _2 == 1, _3 == 2</span>
<span class="kw">local</span> c2 <span class="ot">=</span> makeCounter<span class="ot">()</span>
_<span class="dv">1</span><span class="ot">,</span> _<span class="dv">2</span><span class="ot">,</span> _<span class="dv">3</span> <span class="ot">=</span> c2<span class="ot">(),</span> c1<span class="ot">(),</span> c2<span class="ot">()</span>       <span class="do">-- _1 == 0, _2 == 4, _3 == 1</span></code></pre></div></li>
<li><p>Functions support tail call recursion</p>
<div class="sourceCode"><pre class="sourceCode stretch lua"><code class="sourceCode lua"><span class="kw">function</span> fib<span class="ot">(</span>n<span class="ot">)</span>
    <span class="kw">local</span> <span class="kw">function</span> _fib<span class="ot">(</span>fn2<span class="ot">,</span> fn1<span class="ot">,</span> at<span class="ot">)</span>
        <span class="kw">if</span> at <span class="ot">==</span> n <span class="kw">then</span> 
            <span class="kw">return</span> fn1 <span class="ot">+</span> fn2
        <span class="kw">else</span>
            <span class="do">-- calls it self recursively as a tail call</span>
            <span class="do">-- so it will reuse the same stack frame</span>
            <span class="kw">return</span> _fib<span class="ot">(</span>fn1<span class="ot">,</span> fn1 <span class="ot">+</span> fn2<span class="ot">,</span> at<span class="ot">+</span><span class="dv">1</span><span class="ot">)</span>
        <span class="kw">end</span>
    <span class="kw">end</span>
    <span class="kw">if</span> n <span class="ot">&lt;=</span> <span class="dv">0</span> <span class="kw">then</span> <span class="kw">return</span> <span class="dv">0</span>
    <span class="kw">elseif</span> n <span class="ot">==</span> <span class="dv">1</span> <span class="kw">then</span> <span class="kw">return</span> <span class="dv">1</span>
    <span class="kw">else</span> <span class="kw">return</span> _fib<span class="ot">(</span><span class="dv">0</span><span class="ot">,</span> <span class="dv">1</span><span class="ot">,</span> <span class="dv">2</span><span class="ot">)</span> <span class="kw">end</span>
<span class="kw">end</span>
<span class="do">-- no stack overflow</span>
<span class="do">-- prints : n4 = 2 n8 = 13 n1000 = 2.6863810024485e+208 n10000 = 1.#INF</span>
<span class="fu">print</span> <span class="ot">(</span><span class="st">'n4 = '</span> <span class="ot">..</span> fib<span class="ot">(</span><span class="dv">4</span><span class="ot">)</span> <span class="ot">..</span> <span class="st">' n8 = '</span><span class="ot">..</span> fib<span class="ot">(</span><span class="dv">8</span><span class="ot">)</span> <span class="ot">..</span> <span class="st">' n1000 = '</span> <span class="ot">..</span> fib<span class="ot">(</span><span class="dv">1000</span><span class="ot">)</span>
    <span class="ot">..</span> <span class="st">' n10000 = '</span> <span class="ot">..</span> fib<span class="ot">(</span><span class="dv">10000</span><span class="ot">))</span></code></pre></div></li>
</ul>
</div><div id="control-structures" class="slide section level2">
<h2>Control structures</h2>
<dl>
<dt>do block end</dt>
<dd><p>Introduces local scope</p>
<div class="sourceCode"><pre class="sourceCode stretch lua"><code class="sourceCode lua"><span class="kw">do</span>
    <span class="kw">local</span> onlyVisibleHere <span class="ot">=</span> <span class="dv">5</span>
<span class="kw">end</span></code></pre></div>
<p>if then else</p>
</dd>
<dd><p>Conditional branching with each branch introducing a local scope.</p>
<div class="sourceCode"><pre class="sourceCode stretch lua"><code class="sourceCode lua"><span class="kw">if</span> a <span class="ot">==</span> b <span class="kw">then</span>      <span class="do">-- start if branch</span>
    e <span class="ot">=</span> <span class="dv">2</span>
<span class="kw">elseif</span> a <span class="ot">==</span> c <span class="kw">then</span>  <span class="do">-- optional else if branch</span>
    e <span class="ot">=</span> <span class="dv">3</span> 
<span class="kw">else</span>                <span class="do">-- optional else branch</span>
    e <span class="ot">=</span> <span class="dv">4</span>
<span class="kw">end</span>                 <span class="do">-- required terminator</span></code></pre></div>
</dd>
</dl>
</div><div id="control-structures-continued" class="slide section level2">
<h2>Control structures continued</h2>
<dl>
<dt>while</dt>
<dd><p>If condition is true then repeatedly execute block until false</p>
<div class="sourceCode"><pre class="sourceCode stretch lua"><code class="sourceCode lua"><span class="kw">local</span> a<span class="ot">,</span>b <span class="ot">=</span> <span class="dv">1</span><span class="ot">,</span><span class="dv">5</span>
<span class="kw">while</span> a <span class="ot">&lt;</span> b <span class="kw">do</span>
    a <span class="ot">=</span> a <span class="ot">+</span> <span class="dv">1</span>       <span class="do">-- executes 4 times</span>
<span class="kw">end</span></code></pre></div>
<p>repeat</p>
</dd>
<dd><p>Execute block and if condition is true repeat until false</p>
<div class="sourceCode"><pre class="sourceCode stretch lua"><code class="sourceCode lua"><span class="kw">local</span> a<span class="ot">,</span>b <span class="ot">=</span> <span class="dv">4</span><span class="ot">,</span><span class="dv">5</span>
<span class="kw">repeat</span>
   a <span class="ot">=</span> a <span class="ot">+</span> <span class="dv">1</span>        <span class="do">-- executes 2 times</span>
<span class="kw">until</span> a <span class="ot">==</span> b</code></pre></div>
<p>break</p>
</dd>
<dd><p>Forces enclosing looping structure to terminate immediately</p>
<div class="sourceCode"><pre class="sourceCode stretch lua"><code class="sourceCode lua"><span class="kw">local</span> a <span class="ot">=</span> <span class="dv">1</span>
<span class="kw">while</span> <span class="kw">true</span> <span class="kw">do</span>
    <span class="kw">break</span>
    a <span class="ot">=</span> a <span class="ot">+</span> <span class="dv">1</span>       <span class="do">-- never executes a remains 1</span>
<span class="kw">end</span></code></pre></div>
</dd>
</dl>
</div><div id="control-structures-continued-1" class="slide section level2">
<h2>Control structures continued</h2>
<dl>
<dt>numerical for</dt>
<dd><p>Repeat the block until initial value passes limit incrementing by optional step size. Default step size is 1.</p>
<div class="sourceCode"><pre class="sourceCode stretch lua"><code class="sourceCode lua"><span class="kw">local</span> a <span class="ot">=</span> <span class="dv">1</span>
<span class="kw">for</span> u<span class="ot">=</span><span class="dv">1</span><span class="ot">,</span><span class="dv">10</span> <span class="kw">do</span>
    a <span class="ot">=</span> u       <span class="do">-- executes 10 times (at end a == 10)</span>
<span class="kw">end</span>
<span class="kw">for</span> u<span class="ot">=</span><span class="dv">10</span><span class="ot">,</span><span class="dv">1</span><span class="ot">,-</span><span class="dv">1</span> <span class="kw">do</span>
    a <span class="ot">=</span> u       <span class="do">-- executes 10 times (at end a == 1)</span>
<span class="kw">end</span></code></pre></div>
</dd>
<dt>generic for</dt>
<dd><p>The generic for loop works over functions called iterators. On each iteration, the iterator function is called to produce a new value, stopping when this new value is nil.</p>
<div class="sourceCode"><pre class="sourceCode stretch lua"><code class="sourceCode lua"><span class="kw">local</span> a <span class="ot">=</span> <span class="dv">1</span>
<span class="kw">for</span> k<span class="ot">,</span>v <span class="kw">in</span> <span class="fu">ipairs</span> <span class="ot">{</span><span class="dv">0</span><span class="ot">,</span><span class="dv">1</span><span class="ot">,</span><span class="dv">2</span><span class="ot">,</span><span class="dv">3</span><span class="ot">,</span><span class="dv">4</span><span class="ot">,</span><span class="dv">5</span><span class="ot">,</span><span class="dv">6</span><span class="ot">,</span><span class="dv">7</span><span class="ot">,</span><span class="dv">8</span><span class="ot">,</span><span class="dv">9</span><span class="ot">}</span> <span class="kw">do</span>
    a <span class="ot">=</span> k <span class="ot">+</span> v       <span class="do">-- executes 10 times (at end a == 10 + 9)</span>
<span class="kw">end</span></code></pre></div>
</dd>
</dl>
</div><div id="extensibility-meta-table" class="slide section level2">
<h2>Extensibility (Meta table)</h2>
<ul>
<li>Can extend tables and userdata using meta tables</li>
<li>Meta table is a plain <em>Lua</em> table</li>
<li>Meta table bound to userdata or table using <code>setmetatable(t, mt)</code> function</li>
<li>Inserting functions at specific keys specialize behaviour
<ul>
<li>Arithmetic : <code>__add</code>, <code>__sub</code> etc.</li>
<li>Comparison : <code>__eq</code>, <code>__lt</code> and <code>__le</code>.</li>
<li>Key lookup and new key insertion : <code>__index</code> and <code>__newindex</code></li>
<li>Function call (using object as a function): <code>__call</code></li>
<li>Finalizers : <code>__gc</code> must be set from <em>C</em></li>
</ul></li>
<li>The meta table mechanism is used to extend <em>Lua</em> semantically as needed.</li>
</ul>
</div><div id="metatable-example" class="slide section level2">
<h2>Metatable example</h2>
<ul>
<li>Fibber object based on some number <code>n</code></li>
<li>Fibbers can be added or subtracked</li>
<li>Canât add any values to fibbers</li>
<li>Applying function call to fibbers returns n_th fibonacci number</li>
</ul>
<div class="sourceCode"><pre class="sourceCode stretch lua"><code class="sourceCode lua"><span class="kw">local</span> mtFibber <span class="ot">=</span> <span class="ot">{}</span>
<span class="kw">function</span> makeFibber<span class="ot">(</span>n<span class="ot">)</span>
    <span class="kw">local</span> f <span class="ot">=</span> <span class="ot">{</span>n <span class="ot">=</span> n<span class="ot">}</span>
    <span class="fu">setmetatable</span><span class="ot">(</span>f<span class="ot">,</span> mtFibber<span class="ot">)</span>
    <span class="kw">return</span> f
<span class="kw">end</span>
<span class="kw">do</span>
    <span class="kw">function</span> mtFibber:__call<span class="ot">()</span>
        <span class="kw">local</span> n <span class="ot">=</span> <span class="fu">math.max</span><span class="ot">(</span>self<span class="ot">.</span>n<span class="ot">,</span><span class="dv">0</span><span class="ot">)</span>
        <span class="kw">local</span> <span class="kw">function</span> _fib<span class="ot">(</span>fn2<span class="ot">,</span> fn1<span class="ot">,</span> at<span class="ot">)</span>
            <span class="kw">if</span> at <span class="ot">==</span> n <span class="kw">then</span> 
                <span class="kw">return</span> fn1 <span class="ot">+</span> fn2
            <span class="kw">else</span>
                <span class="kw">return</span> _fib<span class="ot">(</span>fn1<span class="ot">,</span> fn1 <span class="ot">+</span> fn2<span class="ot">,</span> at<span class="ot">+</span><span class="dv">1</span><span class="ot">)</span>
            <span class="kw">end</span>
        <span class="kw">end</span>
        <span class="kw">if</span> n <span class="ot">&lt;=</span> <span class="dv">0</span> <span class="kw">then</span> <span class="kw">return</span> <span class="dv">0</span>
        <span class="kw">elseif</span> n <span class="ot">==</span> <span class="dv">1</span> <span class="kw">then</span> <span class="kw">return</span> <span class="dv">1</span>
        <span class="kw">else</span> <span class="kw">return</span> _fib<span class="ot">(</span><span class="dv">0</span><span class="ot">,</span> <span class="dv">1</span><span class="ot">,</span> <span class="dv">2</span><span class="ot">)</span> <span class="kw">end</span>
    <span class="kw">end</span>
    <span class="kw">function</span> mtFibber<span class="ot">.</span>__add<span class="ot">(</span>lhs<span class="ot">,</span> rhs<span class="ot">)</span> <span class="kw">return</span> makeFibber<span class="ot">(</span>lhs<span class="ot">.</span>n <span class="ot">+</span> rhs<span class="ot">.</span>n<span class="ot">)</span> <span class="kw">end</span>
    <span class="kw">function</span> mtFibber<span class="ot">.</span>__sub<span class="ot">(</span>lhs<span class="ot">,</span> rhs<span class="ot">)</span> <span class="kw">return</span> makeFibber<span class="ot">(</span>lhs<span class="ot">.</span>n <span class="ot">-</span> rhs<span class="ot">.</span>n<span class="ot">)</span> <span class="kw">end</span>
    <span class="kw">function</span> mtFibber:__newindex<span class="ot">(</span>k<span class="ot">,</span>v<span class="ot">)</span> <span class="fu">assert</span><span class="ot">(</span><span class="kw">false</span><span class="ot">,</span> <span class="st">&quot;can't add members&quot;</span><span class="ot">)</span> <span class="kw">end</span>
<span class="kw">end</span>
<span class="kw">local</span> f1 <span class="ot">=</span> makeFibber<span class="ot">(</span><span class="dv">10</span><span class="ot">)</span>
<span class="kw">local</span> f2 <span class="ot">=</span> makeFibber<span class="ot">(</span><span class="dv">5</span><span class="ot">)</span>
<span class="kw">local</span> f3 <span class="ot">=</span> makeFibber<span class="ot">(</span><span class="dv">100</span><span class="ot">)</span>
<span class="kw">local</span> f4 <span class="ot">=</span> <span class="ot">(</span>f3 <span class="ot">+</span> f2 <span class="ot">-</span> f1<span class="ot">)</span>
<span class="do">-- The 95th fibonacci is 3.194043463499e+019</span>
<span class="fu">print</span> <span class="ot">(</span><span class="st">&quot;The &quot;</span> <span class="ot">..</span> f4<span class="ot">.</span>n <span class="ot">..</span> <span class="st">&quot;nth fibonacci number is &quot;</span> <span class="ot">..</span> f4<span class="ot">())</span></code></pre></div>
</div>
<div id="addons" class="titleslide slide section level1"><h1>Addons</h1></div><div id="iup" class="slide section level2">
<h2>IUP</h2>
<ul>
<li>Cross platform native GUI toolkit.</li>
<li>Supports declarative way of GUI definition.</li>
</ul>
<div class="figure">
<img src="../images/IupDialog.png" alt="IUP Dialog" />
<p class="caption">IUP Dialog</p>
</div>
<div class="sourceCode"><pre class="sourceCode stretch lua"><code class="sourceCode lua"><span class="fu">require</span> <span class="st">&quot;iuplua&quot;</span>
<span class="fu">require</span> <span class="st">&quot;iupluacontrols&quot;</span>
<span class="kw">local</span> label
<span class="kw">local</span> text <span class="ot">=</span> <span class="st">&quot;&quot;</span>
<span class="kw">local</span> <span class="kw">function</span> onText<span class="ot">(</span>self<span class="ot">)</span>
    text <span class="ot">=</span> <span class="fu">string.upper</span><span class="ot">(</span>self<span class="ot">.</span>value<span class="ot">)</span>
<span class="kw">end</span>
<span class="kw">local</span> <span class="kw">function</span> modifyLabel<span class="ot">(</span>self<span class="ot">)</span>
    <span class="kw">if</span> label <span class="kw">then</span> 
        label<span class="ot">.</span>title <span class="ot">=</span> text
    <span class="kw">end</span>
<span class="kw">end</span>

dlg <span class="ot">=</span> iup<span class="ot">.</span>dialog
<span class="ot">{</span>
    iup<span class="ot">.</span>vbox
    <span class="ot">{</span>
        iup<span class="ot">.</span>label<span class="ot">{</span>title <span class="ot">=</span> <span class="st">'A silly little dialog'</span><span class="ot">,</span> map_cb <span class="ot">=</span> <span class="kw">function</span><span class="ot">(</span>self<span class="ot">)</span> label <span class="ot">=</span> self <span class="kw">end</span><span class="ot">},</span>
        iup<span class="ot">.</span>vbox
            <span class="ot">{</span>
                iup<span class="ot">.</span>hbox
                <span class="ot">{</span>
                    iup<span class="ot">.</span>label<span class="ot">{</span>title<span class="ot">=</span><span class="st">'Write text'</span><span class="ot">,</span> size<span class="ot">=</span><span class="st">&quot;80&quot;</span><span class="ot">},</span>
                    iup<span class="ot">.</span>text<span class="ot">{</span>size<span class="ot">=</span><span class="st">&quot;80&quot;</span><span class="ot">,</span> valuechanged_cb <span class="ot">=</span> onText<span class="ot">}</span>
                    <span class="ot">;</span>margin<span class="ot">=</span><span class="st">&quot;0&quot;</span><span class="ot">,</span> gap<span class="ot">=</span><span class="st">&quot;10&quot;</span>
                <span class="ot">};</span>
                iup<span class="ot">.</span>hbox
                <span class="ot">{</span>
                    iup<span class="ot">.</span>button<span class="ot">{</span>title<span class="ot">=</span><span class="st">&quot;Ok&quot;</span><span class="ot">,</span>size<span class="ot">=</span><span class="st">&quot;40&quot;</span><span class="ot">,</span> action <span class="ot">=</span> modifyLabel<span class="ot">},</span>
                    iup<span class="ot">.</span>button<span class="ot">{</span>title<span class="ot">=</span><span class="st">&quot;Cancel&quot;</span><span class="ot">,</span>size<span class="ot">=</span><span class="st">&quot;40&quot;</span> <span class="ot">,</span> action <span class="ot">=</span> <span class="kw">function</span> <span class="ot">()</span> <span class="kw">return</span> iup<span class="ot">.</span>CLOSE <span class="kw">end</span><span class="ot">}</span>
                    <span class="ot">;</span>margin<span class="ot">=</span><span class="st">&quot;0&quot;</span><span class="ot">,</span> gap<span class="ot">=</span><span class="st">&quot;10&quot;</span>
                <span class="ot">};</span>  
            <span class="ot">}</span>
        <span class="ot">;</span>margin<span class="ot">=</span><span class="st">&quot;5x5&quot;</span><span class="ot">,</span> gap<span class="ot">=</span><span class="st">&quot;5&quot;</span>
    <span class="ot">}</span>
    <span class="ot">;</span>title<span class="ot">=</span><span class="st">&quot;Some dialog&quot;</span><span class="ot">,</span> resize<span class="ot">=</span><span class="st">&quot;NO&quot;</span>
<span class="ot">}</span>
dlg:popup<span class="ot">()</span></code></pre></div>
</div><div id="cosmo" class="slide section level2">
<h2>Cosmo</h2>
<ul>
<li>Cosmo is a âsafe templatesâ engine.</li>
<li>It allows you to fill nested templates.</li>
<li>Many of the advantages of Turing-complete template engines, without without the downside of allowing arbitrary code in the templates.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode stretch lua"><code class="sourceCode lua"><span class="kw">local</span> cosmo <span class="ot">=</span> <span class="fu">require</span> <span class="st">&quot;cosmo&quot;</span>
mycards <span class="ot">=</span> <span class="ot">{</span> <span class="ot">{</span>rank<span class="ot">=</span><span class="st">&quot;Ace&quot;</span><span class="ot">,</span> suit<span class="ot">=</span><span class="st">&quot;Spades&quot;</span><span class="ot">}</span>
          <span class="ot">,</span> <span class="ot">{</span>rank<span class="ot">=</span><span class="st">&quot;Queen&quot;</span><span class="ot">,</span> suit<span class="ot">=</span><span class="st">&quot;Diamonds&quot;</span><span class="ot">}</span>
          <span class="ot">,</span> <span class="ot">{</span>rank<span class="ot">=</span><span class="st">&quot;10&quot;</span><span class="ot">,</span> suit<span class="ot">=</span><span class="st">&quot;Hearts&quot;</span><span class="ot">}</span> 
          <span class="ot">}</span> 
template <span class="ot">=</span> <span class="st">&quot;$do_cards[[$rank of $suit, ]]&quot;</span>
<span class="do">-- prints Ace of Spades, Queen of Diamonds, 10 of Hearts,</span>
<span class="fu">print</span> <span class="ot">(</span>cosmo<span class="ot">.</span>fill<span class="ot">(</span>template<span class="ot">,</span> <span class="ot">{</span>do_cards <span class="ot">=</span> mycards<span class="ot">}))</span></code></pre></div>
</div><div id="penlight" class="slide section level2">
<h2>Penlight</h2>
<ul>
<li>Your batteries for general development</li>
<li>Adds support for functional style</li>
</ul>
<div class="sourceCode"><pre class="sourceCode stretch lua"><code class="sourceCode lua"><span class="kw">local</span> List <span class="ot">=</span> <span class="fu">require</span> <span class="st">'pl.List'</span>  
<span class="kw">local</span> func <span class="ot">=</span> <span class="fu">require</span> <span class="st">'pl.func'</span>  
<span class="fu">print</span> <span class="ot">(</span>List<span class="ot">{</span><span class="dv">10</span><span class="ot">,</span><span class="dv">20</span><span class="ot">,</span><span class="dv">30</span><span class="ot">}</span>:map<span class="ot">(</span>_<span class="dv">1</span><span class="ot">+</span><span class="dv">1</span><span class="ot">)</span>:reduce <span class="st">'+'</span><span class="ot">)</span> <span class="do">-- prints 63</span></code></pre></div>
<ul>
<li>Standard class system using meta tables</li>
</ul>
<div class="sourceCode"><pre class="sourceCode stretch lua"><code class="sourceCode lua"> class <span class="ot">=</span> <span class="fu">require</span> <span class="st">'pl.class'</span>

 class<span class="ot">.</span>Animal<span class="ot">()</span>
 <span class="kw">function</span> Animal:_init<span class="ot">(</span>name<span class="ot">)</span>
     self<span class="ot">.</span>name <span class="ot">=</span> name
 <span class="kw">end</span>
 <span class="kw">function</span> Animal:__tostring<span class="ot">()</span>
   <span class="kw">return</span> self<span class="ot">.</span>name<span class="ot">..</span><span class="st">': '</span><span class="ot">..</span>self:speak<span class="ot">()</span>
 <span class="kw">end</span>

 class<span class="ot">.</span>Dog<span class="ot">(</span>Animal<span class="ot">)</span>
 <span class="kw">function</span> Dog:speak<span class="ot">()</span>
   <span class="kw">return</span> <span class="st">'bark'</span>
 <span class="kw">end</span>

 class<span class="ot">.</span>Cat<span class="ot">(</span>Animal<span class="ot">)</span>
 <span class="kw">function</span> Cat:_init<span class="ot">(</span>name<span class="ot">,</span>breed<span class="ot">)</span>
     self:super<span class="ot">(</span>name<span class="ot">)</span>  <span class="do">-- must init base!</span>
     self<span class="ot">.</span>breed <span class="ot">=</span> breed
 <span class="kw">end</span>
 <span class="kw">function</span> Cat:speak<span class="ot">()</span>
   <span class="kw">return</span> <span class="st">'meow'</span>
 <span class="kw">end</span>

fido <span class="ot">=</span> Dog<span class="ot">(</span><span class="st">'Fido'</span><span class="ot">)</span>
felix <span class="ot">=</span> Cat<span class="ot">(</span><span class="st">'Felix'</span><span class="ot">,</span><span class="st">'Tabby'</span><span class="ot">)</span>

<span class="fu">print</span><span class="ot">(</span>fido<span class="ot">,</span>felix<span class="ot">)</span>        <span class="do">-- Fido: bark Felix: meow</span>
<span class="fu">print</span><span class="ot">(</span>felix:is_a<span class="ot">(</span>Animal<span class="ot">)</span> <span class="do">-- true</span>
<span class="fu">print</span><span class="ot">(</span>felix:is_a<span class="ot">(</span>Dog<span class="ot">))</span>   <span class="do">-- false</span>
<span class="fu">print</span><span class="ot">(</span>felix:is_a<span class="ot">(</span>Cat<span class="ot">))</span>   <span class="do">-- true</span></code></pre></div>
</div><div id="metalua" class="slide section level2">
<h2>MetaLua</h2>
<ul>
<li>Static meta programming system for Lua</li>
<li>Alter compilation process in arbitrary, powerful and maintainable ways</li>
<li>Comes with some useful extensions built in
<ul>
<li>Pattern matching like in Haskell an ML</li>
<li>list comprehension</li>
</ul></li>
</ul>
<div class="sourceCode"><pre class="sourceCode stretch lua"><code class="sourceCode lua"><span class="ot">-{</span>extension <span class="st">&quot;clist&quot;</span><span class="ot">}</span>

<span class="do">-- integers from 2 to 50, by steps of 2:</span>
x <span class="ot">=</span> <span class="ot">{</span> i <span class="kw">for</span> i <span class="ot">=</span> <span class="dv">2</span><span class="ot">,</span> <span class="dv">50</span><span class="ot">,</span> <span class="dv">2</span> <span class="ot">}</span>

<span class="do">-- the same, obtained by filtering over all integers &lt;= 50:</span>
y <span class="ot">=</span> <span class="ot">{</span> i <span class="kw">for</span> i <span class="ot">=</span> <span class="dv">1</span><span class="ot">,</span> <span class="dv">50</span> <span class="kw">if</span> i%<span class="dv">2</span><span class="ot">==</span><span class="dv">0</span> <span class="ot">}</span>


<span class="ot">-{</span>extension <span class="st">'match'</span><span class="ot">}</span>

match <span class="ot">{</span> <span class="ot">{</span> <span class="st">'o'</span><span class="ot">,</span> <span class="st">'k'</span><span class="ot">,</span> <span class="st">'!'</span> <span class="ot">}</span> <span class="ot">}</span> with
| <span class="ot">{</span> t <span class="ot">}</span> <span class="ot">-&gt;</span> match t with
   | <span class="ot">{</span> a<span class="ot">,</span> b <span class="ot">}</span>      <span class="ot">-&gt;</span> <span class="fu">print</span> <span class="st">'KO'</span>
   | <span class="ot">{</span> a<span class="ot">,</span> b<span class="ot">,</span> <span class="ot">...</span> <span class="ot">}</span> <span class="ot">-&gt;</span> <span class="fu">print</span> <span class="ot">(</span>a<span class="ot">..</span>b<span class="ot">)</span>
   | _             <span class="ot">-&gt;</span> <span class="fu">print</span> <span class="st">'KO'</span>
   <span class="kw">end</span>
| _ <span class="ot">-&gt;</span> <span class="fu">print</span> <span class="st">'KO'</span>
<span class="kw">end</span></code></pre></div>
</div>
<div id="how-do-we-use-it" class="titleslide slide section level1"><h1>How do we use it</h1></div><div id="build-automation" class="slide section level2">
<h2>Build Automation</h2>
<ul>
<li>Scripts to pull repository version info into builds</li>
<li>Scripts to generate project skeletons</li>
<li>Scripts to generate code</li>
</ul>
</div><div id="data-definition-language" class="slide section level2">
<h2>Data definition language</h2>
<ul>
<li>Instead of writing a compiler</li>
<li>We defined a DSL based on <em>Lua</em> tables</li>
<li>Use <em>Lua</em> as the compiler</li>
<li>Generate <em>C++</em> code</li>
</ul>
<div class="sourceCode"><pre class="sourceCode stretch lua"><code class="sourceCode lua">FLiDataCompiler
<span class="ot">{</span>INCLUDE_PCH <span class="ot">=</span> <span class="st">[[#include &quot;fliModelsPCH.h&quot;]]</span><span class="ot">;</span>
 INCLUDE_LIB <span class="ot">=</span> <span class="st">[[#include &quot;../fliModelsLib.h&quot;]]</span><span class="ot">;</span>
 EXPORT_DECL <span class="ot">=</span> <span class="st">[[fliMODELS_API]]</span><span class="ot">;</span>
 INCLUDES <span class="ot">=</span> <span class="ot">{</span><span class="st">&quot;dmlGoalState.dsd&quot;</span><span class="ot">,</span> <span class="st">&quot;dmlGoalChildrenConstraint.dsd&quot;</span><span class="ot">,</span> <span class="st">&quot;dmlTrigger.dmd&quot;</span><span class="ot">};</span>
 <span class="st">[[ @brief  Goals are a hierarchical way to define what an entity is required to achieve. </span>
<span class="st"> ]]</span><span class="ot">;</span>
 MODEL <span class="ot">=</span> <span class="ot">{</span><span class="st">&quot;fli::act::DGoal&quot;</span><span class="ot">;</span>
    <span class="st">[[@brief String used to categorize the goal with categories seperated by / also used to identify the goal]]</span><span class="ot">;</span>
    <span class="ot">{</span><span class="st">&quot;Category&quot;</span><span class="ot">,</span> <span class="ot">{</span><span class="st">&quot;string&quot;</span><span class="ot">,</span> <span class="dv">1</span><span class="ot">}};</span>
 
    <span class="st">[[@brief The current active state of the goal]]</span><span class="ot">;</span>
    <span class="ot">{</span><span class="st">&quot;State&quot;</span><span class="ot">,</span> <span class="ot">{</span><span class="st">&quot;EGoalState&quot;</span><span class="ot">,</span> <span class="dv">2</span><span class="ot">,</span> default<span class="ot">=</span><span class="st">'GOAL_INACTIVE'</span><span class="ot">}};</span>
 
    <span class="st">[[@brief Constrain how the goal's children become active when it is active]]</span><span class="ot">;</span>
    <span class="ot">{</span><span class="st">&quot;ChildrenConstraint&quot;</span><span class="ot">,</span> <span class="ot">{</span><span class="st">&quot;EGoalChildrenConstraint&quot;</span><span class="ot">,</span> <span class="dv">3</span><span class="ot">,</span> default<span class="ot">=</span><span class="st">&quot;GOAL_CHILDREN_ACTIVE_CONCURRENTLY&quot;</span><span class="ot">}};</span>

    <span class="st">[[@brief Child goals]]</span><span class="ot">;</span>
    <span class="ot">{</span><span class="st">&quot;Children&quot;</span><span class="ot">,</span> <span class="ot">{</span><span class="st">&quot;array&lt;DGoal&gt;&quot;</span><span class="ot">,</span> <span class="dv">4</span><span class="ot">}};</span>

    <span class="ot">...</span>
    <span class="ot">...</span>

    <span class="st">[[@brief The number of times the goal has passed]]</span><span class="ot">;</span>
    <span class="ot">{</span><span class="st">&quot;PassedCount&quot;</span><span class="ot">,</span> <span class="ot">{</span><span class="st">&quot;int32&quot;</span><span class="ot">,</span> <span class="dv">9</span><span class="ot">,</span> set<span class="ot">=</span><span class="kw">false</span><span class="ot">}};</span>

    <span class="st">[[@brief The number of times the goal has failed]]</span><span class="ot">;</span>
    <span class="ot">{</span><span class="st">&quot;FailedCount&quot;</span><span class="ot">,</span> <span class="ot">{</span><span class="st">&quot;int32&quot;</span><span class="ot">,</span> <span class="dv">10</span><span class="ot">,</span> set<span class="ot">=</span><span class="kw">false</span><span class="ot">}};</span>

 <span class="ot">};</span>
<span class="ot">};</span></code></pre></div>
</div><div id="data-description-language" class="slide section level2">
<h2>Data description language</h2>
<ul>
<li>We have component hierarchies which can be serialized as XML, binary etc.</li>
<li>XML is not human write friendly</li>
<li>We use <em>Lua</em>âs tables to declaritively build the hierarchies</li>
<li>This is more succint</li>
<li>This is more flexible</li>
<li>Still have full power of <em>Lua</em> where needed</li>
</ul>
<div class="sourceCode"><pre class="sourceCode stretch lua"><code class="sourceCode lua">fli_data<span class="ot">.</span>ScopeModelCreate<span class="ot">()</span>
<span class="kw">local</span> DoNotRegister <span class="ot">=</span> <span class="kw">true</span>  <span class="do">-- Do not register with fli::data::CManager</span>

<span class="do">-----------------------------------------------------</span>
<span class="do">-- Scenario world</span>
<span class="do">-----------------------------------------------------</span>
<span class="do">-- Define the whole world for the scenario defining which extensions the world has as well as all the entities which are</span>
<span class="do">-- present in the world. </span>
<span class="kw">return</span> Root<span class="ot">(</span>fli__ent__DWorld<span class="ot">(</span><span class="st">&quot;World&quot;</span><span class="ot">),</span> DoNotRegister<span class="ot">)</span>
<span class="ot">{</span>
    Extensions <span class="ot">=</span>
    <span class="ot">{</span>
        <span class="do">-- Extension that defines information related to the scenario but not a specific entity</span>
        fli__ent__DScenarioInfo
        <span class="ot">{</span>
            Name <span class="ot">=</span> <span class="st">&quot;Tutorial_03_SimpleVehicle&quot;</span><span class="ot">;</span>     
            FocusEntity <span class="ot">=</span> RefModel<span class="ot">(</span><span class="st">&quot;World:Entities.1&quot;</span><span class="ot">);</span>
        <span class="ot">};</span>
    <span class="ot">};</span>
    
    Entities <span class="ot">=</span> 
    <span class="ot">{</span>
        Import<span class="ot">(</span><span class="fu">assert</span><span class="ot">(</span>RelToData <span class="st">&quot;FLiTutorials/Tutorial_03_SimpleVehicle/Scripts/Terrain.lua&quot;</span><span class="ot">))</span>
        <span class="ot">{</span>           
            InInitialTimeOfDay <span class="ot">=</span> <span class="dv">16</span> <span class="ot">*</span> <span class="dv">60</span> <span class="ot">*</span> <span class="dv">60</span><span class="ot">;</span>
        <span class="ot">};</span>
    
        Import<span class="ot">(</span><span class="fu">assert</span><span class="ot">(</span>RelToData <span class="st">&quot;FLiTutorials/Tutorial_03_SimpleVehicle/Scripts/SimpleEntityOfTutorial2.lua&quot;</span><span class="ot">))</span>
        <span class="ot">{</span>           
            InName <span class="ot">=</span> <span class="st">&quot;My Imported Entity&quot;</span><span class="ot">;</span>
            InPhysicsEnableDebugDrawing <span class="ot">=</span> <span class="kw">true</span><span class="ot">;</span>
            InPosition <span class="ot">=</span> <span class="ot">{</span>x<span class="ot">=-</span><span class="dv">100</span><span class="ot">;</span>y<span class="ot">=</span><span class="dv">50</span><span class="ot">;</span>z<span class="ot">=</span><span class="dv">0</span><span class="ot">;};</span>
            InOrientation <span class="ot">=</span> QuaternionToTable<span class="ot">(</span> OrientFromYPRd<span class="ot">(</span><span class="dv">0</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">)</span> <span class="ot">);</span>
            InVisualColour <span class="ot">=</span> <span class="ot">{</span>r<span class="ot">=</span><span class="dv">0</span><span class="ot">,</span> g<span class="ot">=</span><span class="dv">1</span><span class="ot">,</span> b<span class="ot">=</span><span class="dv">0</span><span class="ot">,</span> a<span class="ot">=</span><span class="dv">1</span><span class="ot">};</span>
        <span class="ot">};</span>
        
        Import<span class="ot">(</span><span class="fu">assert</span><span class="ot">(</span>RelToData <span class="st">&quot;FLiTutorials/Tutorial_03_SimpleVehicle/Scripts/SimpleEntityOfTutorial2.lua&quot;</span><span class="ot">))</span>
        <span class="ot">{</span>           
            InName <span class="ot">=</span> <span class="st">&quot;My Second Imported Entity&quot;</span><span class="ot">;</span>
            InPhysicsEnableDebugDrawing <span class="ot">=</span> <span class="kw">true</span><span class="ot">;</span>
            InPosition <span class="ot">=</span> <span class="ot">{</span>x<span class="ot">=-</span><span class="dv">100</span><span class="ot">;</span>y<span class="ot">=</span><span class="dv">50</span><span class="ot">;</span>z<span class="ot">=</span><span class="dv">10</span><span class="ot">;};</span>
            InOrientation <span class="ot">=</span> QuaternionToTable<span class="ot">(</span> OrientFromYPRd<span class="ot">(</span>DEG_TO_RAD<span class="ot">(</span><span class="dv">60</span><span class="ot">),</span> <span class="dv">0</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">)</span> <span class="ot">);</span>
            InVisualColour <span class="ot">=</span> <span class="ot">{</span>r<span class="ot">=</span><span class="dv">0</span><span class="ot">,</span> g<span class="ot">=</span><span class="dv">1</span><span class="ot">,</span> b<span class="ot">=</span><span class="dv">1</span><span class="ot">,</span> a<span class="ot">=</span><span class="dv">1</span><span class="ot">};</span>
        <span class="ot">};</span>
        
        Import<span class="ot">(</span><span class="fu">assert</span><span class="ot">(</span>RelToData <span class="st">&quot;FLiTutorials/Tutorial_03_SimpleVehicle/Scripts/SimpleEntityOfTutorial2.lua&quot;</span><span class="ot">))</span>
        <span class="ot">{</span>           
            InName <span class="ot">=</span> <span class="st">&quot;My Third Imported Entity&quot;</span><span class="ot">;</span>
            InPhysicsEnableDebugDrawing <span class="ot">=</span> <span class="kw">true</span><span class="ot">;</span>
            InPosition <span class="ot">=</span> <span class="ot">{</span>x<span class="ot">=-</span><span class="dv">110</span><span class="ot">;</span>y<span class="ot">=</span><span class="dv">50</span><span class="ot">;</span>z<span class="ot">=</span><span class="dv">10</span><span class="ot">;};</span>
            InOrientation <span class="ot">=</span> QuaternionToTable<span class="ot">(</span> OrientFromYPRd<span class="ot">(</span><span class="dv">0</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">,</span> DEG_TO_RAD<span class="ot">(</span><span class="dv">30</span><span class="ot">))</span> <span class="ot">);</span>
            InVisualColour <span class="ot">=</span> <span class="ot">{</span>r<span class="ot">=</span><span class="dv">1</span><span class="ot">,</span> g<span class="ot">=</span><span class="dv">0</span><span class="ot">,</span> b<span class="ot">=</span><span class="dv">1</span><span class="ot">,</span> a<span class="ot">=</span><span class="dv">0.5</span><span class="ot">};</span>
        <span class="ot">};</span>
    <span class="ot">};</span>
<span class="ot">}</span></code></pre></div>
</div>
<div id="the-end" class="titleslide slide section level1"><h1>The End</h1></div>
  </body>
</html>
